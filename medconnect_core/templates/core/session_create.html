<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor's Notes and Prescriptions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2c3e50',
                        secondary: '#3498db',
                        accent: '#e74c3c',
                        background: '#ecf0f1',
                    }
                }
            }
        }
    </script>
    <style>
.thing{
    margin-bottom:100px;
}

    </style>
</head>
<body class="bg-background min-h-screen flex flex-col">
    
    <div class="thing">{% include "core/nav.html" %}
    </div>
    <main class="flex-grow container mx-auto p-4 flex flex-col md:flex-row gap-4">
        <aside class="md:w-3/4 bg-white rounded-lg shadow-md p-4">
            <h2 class="text-xl font-bold text-primary mb-4">Write Prescription</h2>
            <form method="post" id="prescriptionForm">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="{{ patient_form.patient_search.id_for_label }}" class="block mb-2 text-gray-700">Search Patient</label>
                    {{ patient_form.patient_search }}
                </div>
                <div id="patientSearchResults" class="mb-4"></div>
                {{ patient_form.selected_patient }}
                <div id="selectedPatientInfo" class="mb-4 hidden">
                    <strong>Selected Patient:</strong> <span id="selectedPatientName"></span>
                </div>
                <div class="mb-4">
                    <label for="{{ session_form.medication.id_for_label }}" class="block mb-2 text-gray-700">Medications</label>
                    {{ session_form.medication }}
                </div>
                <div class="mb-4">
                    <label for="{{ session_form.dosage.id_for_label }}" class="block mb-2 text-gray-700">Dosage</label>
                    {{ session_form.dosage }}
                </div>
                <div class="mb-4">
                    <label for="{{ session_form.instructions.id_for_label }}" class="block mb-2 text-gray-700">Instructions</label>
                    {{ session_form.instructions }}
                </div>
                <button type="submit" class="bg-secondary hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">
                    <i class="fas fa-prescription-bottle mr-2"></i>Submit Prescription
                </button>
            </form>
        </aside>
    </main>
    
   

    <footer class="bg-primary text-white p-4 mt-4">
        <div class="container mx-auto text-center">
            <p>&copy; 2024 TeleMed. All rights reserved.</p>
        </div>
    </footer>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        var searchTimeout;
        $('#id_patient_search').on('input', function() {
            clearTimeout(searchTimeout);
            var query = $(this).val();
            searchTimeout = setTimeout(function() {
                if (query.length > 0    ) {
                    $.ajax({
                        url: '{% url "search_patients" %}',
                        data: {
                            'q': query
                        },
                        success: function(data) {
                            var results = $('#patientSearchResults');
                            results.empty();
                            if (data.length > 0) {
                                $.each(data, function(index, item) {
                                    results.append(
                                        $('<div>')
                                            .addClass('patient-result cursor-pointer p-2 hover:bg-gray-100')
                                            .text(item.name)
                                            .data('patient-id', item.id)
                                            .data('patient-name', item.name)
                                    );
                                });
                            } else {
                                results.append($('<div>').text('No patients found'));
                            }
                        }
                    });
                } else {
                    $('#patientSearchResults').empty();
                }
            }, 300);
        });

        $(document).on('click', '.patient-result', function() {
            var patientId = $(this).data('patient-id');
            var patientName = $(this).data('patient-name');
            $('#id_selected_patient').val(patientId);
            $('#selectedPatientName').text(patientName);
            $('#selectedPatientInfo').removeClass('hidden');
            $('#patientSearchResults').empty();
            $('#id_patient_search').val('');
        });
    });
</script>
</html>
